---
layout: post
title: outset Out of the Ordinary
---
<p><cite><a href="#july21">Additional content added 2015 July 21</a></cite></p>
<p>I hope many of you have heard of a nice little tool from Joseph Chilcote called <a href="https://github.com/chilcote/outset"><cite>outset</cite></a>. Instead of having to write LaunchAgents and LaunchDaemons on your own, particularly for one-off tasks, you can just drop scripts or packages into an appropriately-named folder and let <cite>outset</cite> do the work for you. I've just started exploring it, but it looks like it will have great potential for us.</p>
<p>When OS X 10.10.4 came out, I started pushing it out to my Lab Macs using Apple Remote Desktop (no Munki or Casper yet). So all is well until I get to the 5 computers where a professor is doing batch processing in Photoshop. These runs can take days sometimes, as he is routinely dealing with hundreds of 1 GB images in a batch. But 10.10.4 is a pretty important update for security reasons, so I want to push it out as soon as possible. So what about having <cite>outset</cite> do it?</p>
<p>You need to understand, in the words of Joseph Chilcote, this was "<a href="https://x.com/chilcote/status/618843210673225728">another usage that would have never crossed my mind.</a>"<a href="#foot1" id="ref1"><sup>[1]</sup></a> In other words, who knows if it is going to work! I figured if I could copy the 1 GB update to the Macs in questions in the background, a manually-triggered restart should do the installation for me. So I tried tested this on one the Macs that had not yet been upgraded using ARD and, once I put the 10.10.4 update package in /usr/local/outset/firstboot-packages, I had ARD restart the Macs.</p>
<p>The first attempt was a bust. Even though Apple's installer package was happy to run in the GUI with 644 permissions (execute not set), <cite>outset</cite> insists on root:wheel ownership and 755 permissions (execute set). So I copied it again (since <cite>outset</cite> dutifully deleted it afterwards), changed the permissions (using ARD), and rebooted.</p>
<p>This was much more successful, although it did not appear so initially. Because of the way our Labs are setup, we have a restricted user account login automatically after (re)boot. I had expected to see the OS updater to take over the display, but instead, it appeared to login to the user account without any significant delay. By the time I checked the logs (/var/logs/outset.log in this case), it said the install had completed. Yet ARD was still reporting that the Mac was at 10.10.3. I remoted in to the Mac and <cite>About This Mac</cite> claimed it was 10.10.4. Remembering that the installer, when run manually, triggered its own reboot, I decided to ask ARD to reboot the Mac again. Success! Now both the OS and ARD were reporting 10.10.4.</p>
<p>This was now an instruction that I could give to this prof that he could understand: when you're done your run, Restart, wait 10 minutes, Restart, then you're good to go. (Admittedly, I beat him to it, since it is difficult to predict how long these batch processes will take. The prof usually tries to setup jobs that take a couple of days to run.)</p>
<p>When I <a href="https://x.com/anthonyreimer/status/618842736737648640">floated this out on Twitter,</a><a href="#foot2" id="ref2"><sup>[2]</sup></a> the esteemed Mr. Chilcote suggested I try running softwareupdate in a firstboot script. I had not updated my spare iMac yet, so I gave that a go. I wrote a one-line shell script to invoke softwareupdate from the command line and placed it in outset's firstboot-scripts folder. Different result. The good news: it never did log into a user account; you got the regular boot progress bar as is customary in Yosemite (and later, I presume). The bad news: it got stuck at about 20% progress. I waited 10 minutes, then turned the computer off and tried again. It got to 20% and gave me a much more interesting failure:</p>
<blockquote><b>Unapproved caller.</b><br />Security agent may only be invoked by Apple software.</blockquote>
<p>Ouch. This dialogue box can't be dismissed, despite repeated clicking on the OK button, so it's time to power down again. This time, I start up with the Shift key held down. Lo and behold, a different, fatter, progress bar appears. Now this makes some sense. You see, I decided to write that softwareupdate script so that it grabbed all software updates, not just the 10.10.4 one. This was my spare, so it was entirely possible that some updates had not been pushed to it. What I'm guessing is that softwareupdate thought that the iMac's firmware needed updating. This would have been one of the payload items, so the Security Agent invocation most likely came from the firmware updater.</p>
<p>Once it finished the firmware update, everything seemed to be hunky dory. So my next test is to take a Mac (that I know has current firmware) and test it again. But that will be a while from now, as I indulge my music geekery for a week. I'll update this article when I do so. Of course, you could also do the testing yourself and post the results. Make sure to let me know if you do this and I'll link to your post.</p>
<h3 id="july21">Update - July 21</h3>
<p>My test using a Mac mini (Late 2012) pretty much confirmed all of my findings. You see, just as I was getting ready to test, a <a href="https://support.apple.com/kb/DL1828">firmware update for the Late 2012 Mac minis</a> was released. So I ended up testing the Mac mini in the same way as I tested the iMac before it. The result was basically the same: with a firmware update in the softwareupdate payload, the installer stalled (with the progress bar at about 50% in this case) and a manual shutdown was necessary, even after letting the Mac mini sit overnight (~16 hours). Once I manually applied the Firmware update to the Mac mini, I then nuked the boot volume using a DeployStudio workflow that deployed a minimal 10.10.3 image, added outset, and put the softwareupdate script in the firstboot-scripts folder with the proper ownership and (luckily) permissions. When it rebooted, softwareupdate worked properly (even rebooting on its own, if I observed correctly). I may repeat this test again for completeness, but for now, it sure looks like the softwareupdate script method could "just work" so long as there were no complicating updates.</p>
<p>For the record, I used the following script:</p>
<pre>
#!/bin/sh
# make sure we are using Apple SUS because of issues with our own
defaults delete /Library/Preferences/com.apple.SoftwareUpdate CatalogURL
# and now the real reason for this script:
softwareupdate --install --all
</pre>
<p>The defaults command actually failed on the specific image I was using, but it did not stop execution of the softwareupdate command. You could specify which item you wanted to install, but this was more general purpose.</p>
<p>Of course, the random thought in my mind is: could <a href="https://github.com/grahamgilbert/imagr">Imagr</a> + outset be a DeployStudio replacement for some based on this? (This assumes your needs are simple and Munki/Casper are not going to be deployed.)</p>
<p><cite>Originally posted on the University of Calgary Integrated Arts Media Labs web site.</cite></p>
<p><cite>Additional content added 2015-07-21.</cite></p>
<p><cite>Updated 2025-04-21 to archive information from Twitter (now X) that may no longer be available without an account and/or without following a private account.</cite></p>
<hr/>
<p id="foot1">[1] Original post from Twitter (now X):</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://x.com/AnthonyReimer?ref_src=twsrc%5Etfw">@AnthonyReimer</a> another usage that would have never crossed my mind. Was the two boots part of the installer process?</p>&mdash; Joseph Chilcote (@chilcote) <a href="https://x.com/chilcote/status/618843210673225728?ref_src=twsrc%5Etfw">July 8, 2015</a></blockquote>
<p>An <a href="/assets/files/chilcote_twitter_exchange.html" target="_blank">offline archive of the full discussion</a> is available. <a href="#ref1">[Return to main text]</a></p>
<p id="foot2">[2] Original post from Twitter (now X):</p> 
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Did an experiment with @chilcote's outset. Put 10.10.4Upd in firstboot-packages. Needed 2 boots & 755 permissions, but it worked! #MacAdmins</p>&mdash; Anthony Reimer (@AnthonyReimer) <a href="https://x.com/AnthonyReimer/status/618842736737648640?ref_src=twsrc%5Etfw">July 8, 2015</a></blockquote>
<p>An <a href="/assets/files/chilcote_twitter_exchange.html" target="_blank">offline archive of the full discussion</a> is available. <a href="#ref2">[Return to main text]</a></p>