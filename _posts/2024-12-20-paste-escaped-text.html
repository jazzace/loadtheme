---
layout: post
title: Paste Escaped Text
---
<p>Who needs a Comments section when you have the Mac Admins Slack, Mastodon, and dedicated Mac Admins bloggers! Apparently there is more to know about inserting paths and existing Terminal features. So a follow-up to my <a href="/2024/12/14/copy-as-pathname.html">blog post on Copy as Pathname</a> is in order.</p>
<h3>Paste Escaped</h3>
<p>On The Mac Admins Slack, <a href="https://macadmins.slack.com/archives/C4ENKD38A/p1734333526868049" target="_blank">Graham Pugh pointed out</a> that if you have text on the clipboard, you have the option of pasting that text “escaped” in Terminal. Simply copy the text from whatever source you choose (e.g., the output of an AutoPkg run, where paths are not escaped), then in Terminal choose Edit > Pasted Escaped Text or use the shortcut Command-Control-V. All spaces, single-quotes, or double-quotes will be escaped (it may escape other things, but those are the obvious ones I tested related to paths).</p>
<p>As a bonus, this concept can be applied to <a href="https://scriptingosx.com/obscure/" target="_blank">a tip I learned from Armin Briegel a few years ago</a>, namely that if you select something in Terminal that you want to then paste into the current shell command, you can skip the copy-paste dance and instead just press Command-Shift-V to do it in one step (or if you prefer menus, Edit > Paste Selection). If you add the Control key to that sequence, the text pasted is escaped (Edit > Paste Escaped Selection or Command-Control-Shift-V).</p>
<h3>Unescaped Path</h3>
<p>But maybe you want that unescaped path after all. Prior to the Copy as Pathname feature being added, there were ways with AppleScript or Automator that you could create an escaped path and add it to the Services or Quick Actions contextual menu. The reverse is also true. Here is how you can create a Quick Action that you could use when you select a file or folder in the Finder:</p>
<ol><li>In Automator, create a new Quick Action (File > New…, then select Quick Action and click the Choose button). A mandatory "Workflow receives…" step will be present.</li>
<li>Change the action so that the Workflow receives current “files or folders” in “Finder”.</li>
<li>Drag a Run AppleScript action into the list. A default script will be provided. From the first line, you can remove <code>, parameters</code>, leaving just <code>on run {input}</code>.</li>
<li>Replace the <code>(* Your script goes here *)</code> line with the following one-liner: <code>tell application "Finder" to get POSIX path of first item of (selection as alias list)</code>.</li>
<li>Finally, add a Copy to Clipboard step to the end.</li>
<li>Save with a name like Copy Unescaped Path.</li></ol>
<img style="clear: both;" src="/images/202412_automator_action.png" srcset="/images/202412_automator_action@2x.png 2x" alt="Screenshot of resulting Automator Quick Action" />
<p>By default, this will be saved in <code>~/Library/Services</code> and will be added to the Quick Actions contextual menu (i.e., the menu that is generated when you Control-click or Right-click on an object). You can manage its presence in that menu using System Settings > General > Login Items & Extensions > Extensions section. You can also add a keyboard shortcut to it in System Settings > Keyboard > Keyboard Shortcuts… button > Services (sidebar item) > Files and Folders.</p>
<h3>Footnote</h3>
<p>Finally, <a href="https://social.sourcemac.com/@javerous/113657940415910330" target="_blank">Julien Avérous pointed out</a> on Mastodon that not all shells handle the drag-and-drop of files exactly the same. Admittedly, I had never tried drag-and-drop in any shell other than zsh or bash, nor tried that action when I wasn’t at the beginning of a command or following a space. We discovered through testing that the fish shell behaves differently when you type a single-quote without a following space and then drop the file or folder on the Terminal window; it adds an extra backslash when escaping spaces and quotes. The behaviour we were looking for was if starting with a quote would then generate a non-escaped path when the file or folder was dropped. We couldn’t make that happen, but perhaps you know of a shell that does it that way. Apparently, you know how to get a hold of me if you do find such a shell behaviour. :-)</p>
